<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="~{fragments/fragment-head :: head('Connexion - ENI-Enchères')}"></head>

<body>
<header th:replace="~{fragments/fragment-entete :: entete}"></header>

<main>

    <!-- Bloc d'information de connexion -->
    <section>
        <p sec:authorize="isAuthenticated()">
            ✅ Bonjour 
            <span th:if="${utilisateur != null}" th:text="${utilisateur.pseudo}">Utilisateur</span>, vous êtes connecté !
        </p>
        <p sec:authorize="isAnonymous()">
            ❌ Vous n'êtes pas connecté.
        </p>
    </section>
	<br>
	<br>
	<br>
    <!-- Filtres -->
    <section class="filtres">
      
        <form method="get" th:action="@{/encheres/filtrer}">
          
            <select id="categorie" name="categorie">
                <option value="0" th:selected="${categorie == 0}">Toutes catégories</option>
                <option th:each="cat : ${categories}" th:value="${cat.idCategorie}"
                        th:text="${cat.libelle}"
                        th:selected="${categorie == cat.idCategorie}">Catégorie</option>
            </select>

            <input type="text" placeholder="Le nom de l'article contient"
                   name="nomArticle" th:value="${nomArticle}" />

            <!-- ✅ Choix exclusif entre enchères ouvertes et terminées -->
            <div class="filtre-encheres">
                <label>
                    <input type="radio" name="etatEnchere" value="ouvertes"
                           th:checked="${etatEnchere == null || etatEnchere == 'ouvertes'}" />
                    Enchères ouvertes
                </label>
                <label>
                    <input type="radio" name="etatEnchere" value="terminees"
                           th:checked="${etatEnchere == 'terminees'}" />
                    Enchères terminées
                </label>
                 <label>
                    <input type="radio" name="etatEnchere" value="remportees"
                           th:checked="${etatEnchere == 'remportees'}" />
                    Enchères remportées
                </label>
            </div>

            <button type="submit">Rechercher</button>
        </form>
    </section>

         <!-- Liste des articles -->
        <section class="articles">
            <article class="card" th:each="article : ${articles}">
                <div class="image"></div>
                <div class="details">
                    <p>
		
		                     <a th:href="@{/encheres/detail(idArticle=${article.idArticle}, etatEnchere=${etatEnchere})}">
		  						 <strong th:text="${article.nomArticle}">Nom article</strong>
							</a>
                       <br>
			
                        Prix : <span th:text="${article.prixActuel + ' crédits'}">0 crédits</span><br />
                        
                        Fin de l'enchère :
                        <span th:text="${#temporals.format(article.dateFinEncheres, 'dd/MM/yyyy')}">00/00/0000</span><br />
                        Vendeur :
                        <span th:if="${article.utilisateur != null}" th:text="${article.utilisateur.pseudo}">Vendeur</span>
                        <span th:if="${article.utilisateur == null}">Anonyme</span>
                    </p>
                </div>
            </article>
        </section>

    </main>
</body>
</html>
